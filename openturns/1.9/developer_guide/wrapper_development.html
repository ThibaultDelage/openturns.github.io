
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Wrapper development &#8212; OpenTURNS  documentation</title>
    <link rel="stylesheet" href="../_static/openturns.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: ''
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Git workflow" href="git_workflow.html" />
    <link rel="prev" title="Module development" href="module_development.html" />
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
 

  </head>
  <body>
<div class="pageheader">
  <ul>
    <li><a href="http://www.openturns.org/">Home</a></li>
    <li><a href="../install.html">Get it</a></li>
    <li><a href="../contents.html">Doc</a></li>
    <li><a href="https://github.com/openturns">Code</a></li>
    <li><a href="http://trac.openturns.org">Bugs</a></li>
  </ul>
  <a href="../index.html">
    <h1>
      <img src="../_static/logo-openturns-wo-bg.png" alt="" width=100px height=100px />
      OpenTURNS
    </h1>
    <h2> An Open source initiative for the Treatment of Uncertainties, Risks'N Statistics</h2>
  </a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="git_workflow.html" title="Git workflow"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="module_development.html" title="Module development"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">OpenTURNS  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="developer_guide.html" accesskey="U">Contribute</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Wrapper development</a><ul>
<li><a class="reference internal" href="#pure-python-wrappers">Pure python wrappers</a><ul>
<li><a class="reference internal" href="#pythonfunction">PythonFunction</a></li>
<li><a class="reference internal" href="#external-code-coupling-tools">External code coupling tools</a><ul>
<li><a class="reference internal" href="#simple-example">Simple example</a></li>
<li><a class="reference internal" href="#more-examples">More examples</a><ul>
<li><a class="reference internal" href="#the-replace-function">The replace function</a></li>
<li><a class="reference internal" href="#the-execute-function">The execute function</a></li>
<li><a class="reference internal" href="#the-get-value-function">The get_value function</a></li>
<li><a class="reference internal" href="#the-get-function">The get function</a></li>
<li><a class="reference internal" href="#the-get-regex-function">The get_regex function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reference">Reference</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#performance-considerations-speedo">Performance considerations[speedo]</a><ul>
<li><a class="reference internal" href="#analytical-formula">Analytical formula</a><ul>
<li><a class="reference internal" href="#benchmark-sources">Benchmark sources</a></li>
<li><a class="reference internal" href="#benchmark-results">Benchmark results</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
<li><a class="reference internal" href="#external-process">External process</a><ul>
<li><a class="reference internal" href="#normal-program">Normal program</a></li>
<li><a class="reference internal" href="#tiny-program">Tiny program</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="module_development.html"
                        title="previous chapter">Module development</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="git_workflow.html"
                        title="next chapter">Git workflow</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/developer_guide/wrapper_development.rst"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="wrapper-development">
<h1>Wrapper development<a class="headerlink" href="#wrapper-development" title="Permalink to this headline">¶</a></h1>
<div class="section" id="pure-python-wrappers">
<h2>Pure python wrappers<a class="headerlink" href="#pure-python-wrappers" title="Permalink to this headline">¶</a></h2>
<p>Python wrappers aim to be an easy way for wrapping external code. The
external code can be an analytical mathematical formula or a coupling
involving several computational codes dedicated to the resolution of a
very complex physical problem.</p>
<p>Python wrappers are not the best solution if your external code last
less than a microseconds and if you need to resolve billions of points.
In that case, for better performance, consider using the library
wrapper. In any other cases, Python wrapper is the recommended choice.
For further details on speed optimization see paragraph [speedo].</p>
<p>On OpenTURNS, two Python wrappers are available to wrap an external
code:</p>
<ul class="simple">
<li>the PythonFunction is a simple monothreaded Python wrapper.</li>
<li>the DistributedPythonFunction is a Python wrapper than can launch
code in parallel on the local machine or deploy it among several
computers.</li>
</ul>
<p>These two methods will be described in the following sections.</p>
<div class="section" id="pythonfunction">
<h3>PythonFunction<a class="headerlink" href="#pythonfunction" title="Permalink to this headline">¶</a></h3>
<p>A PythonFunction is a Function where the <code class="docutils literal"><span class="pre">_exec</span></code> or
<code class="docutils literal"><span class="pre">_exec_sample</span></code> function are launched in a Python interpreter. Here is
an example of how to implement it:</p>
<p>Some explanations of the code :</p>
<ul class="simple">
<li>The <code class="docutils literal"><span class="pre">compute_point</span></code> function constructs the out point from the in
point. The in and out array size must correspond to the sizes set in
the PythonFunction constructor. In this example, X will be an array
of size 2 and Y must be an array of size 1. The output point can be a
Python list, an &nbsp;Point or a Numpy array.</li>
<li>Construct the PythonFunction by passing function reference.</li>
</ul>
<p>The <code class="docutils literal"><span class="pre">_exec_sample</span></code> function can be implemented to speedup the compute
using vectorization on large sample. It receives an input sample and
must return an output sample. For further details on speed optimization
see paragraph [speedo]. Here is an example using <code class="docutils literal"><span class="pre">_exec_sample</span></code>
function:</p>
<p>The output sample can be a Sample, a Python list of list or a
Numpy array of array. This function is optional. If <code class="docutils literal"><span class="pre">_exec_sample</span></code> is
not implemented and &nbsp;must compute a sample, the <code class="docutils literal"><span class="pre">_exec</span></code> function is
called several time: once for each point of the sample. On contrary, if
only <code class="docutils literal"><span class="pre">_exec_sample</span></code> is given and a point must be computed, the point
is inserted in a sample of size 1, computed through <code class="docutils literal"><span class="pre">_exec_sample</span></code> and
extracted from the result sample.</p>
<p>The PythonFunction is quite simple to use. When used with
coupling_tools module, it can wrap external program easily too.</p>
</div>
<div class="section" id="external-code-coupling-tools">
<h3>External code coupling tools<a class="headerlink" href="#external-code-coupling-tools" title="Permalink to this headline">¶</a></h3>
<div class="section" id="simple-example">
<h4>Simple example<a class="headerlink" href="#simple-example" title="Permalink to this headline">¶</a></h4>
<p>Here is a simple example of wrapper where compute is made in an external
program with the help of openturns.coupling_tools module:</p>
<p>Some explanations of the code :</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">coupling_tools.replace</span></code> replace <code class="docutils literal"><span class="pre">&#64;E</span></code> and <code class="docutils literal"><span class="pre">&#64;F</span></code> occurence found
in <code class="docutils literal"><span class="pre">input_template.py</span></code> file and write the result to <code class="docutils literal"><span class="pre">infile</span></code>
file. <code class="docutils literal"><span class="pre">X[0]</span></code> value will replace <code class="docutils literal"><span class="pre">'&#64;E'</span></code> token and <code class="docutils literal"><span class="pre">X[1]</span></code> will
replace <code class="docutils literal"><span class="pre">'&#64;F'</span></code> token.</li>
<li>The external program is launched. The input filename is passed by
parameters to the program.</li>
<li><code class="docutils literal"><span class="pre">coupling_tools.get</span></code> get the value following <code class="docutils literal"><span class="pre">'Z='</span></code> token in
<code class="docutils literal"><span class="pre">output.py</span></code> file.</li>
</ul>
<p>Template file example:</p>
<p>External program example:</p>
</div>
<div class="section" id="more-examples">
<h4>More examples<a class="headerlink" href="#more-examples" title="Permalink to this headline">¶</a></h4>
<div class="section" id="the-replace-function">
<h5>The replace function<a class="headerlink" href="#the-replace-function" title="Permalink to this headline">¶</a></h5>
<p>can edit file in place. It can format values in anyway. Actually, values
can be of type “string”, if not, they are converted using str() Python
function:</p>
<hr class="docutils" />
<p><em>replace(infile, outfile, tokens, values, encoding=default_encoding)</em></p>
<hr class="docutils" />
<p><em>infile</em>: template file that will be parsed</p>
<p><em>outfile</em>: file that will received the template parsed. If equal to None
or to <em>infile</em>, the result file will be moved to infile</p>
<p><em>tokens</em>: a list of regex that will be replaced</p>
<p><em>values</em>: list of values (can be string, float, …) that will replace
the tokens. The list must have the same size as tokens</p>
<p><em>encoding</em>: the file encoding, as string, i.e. ascii, latin_1, utf_8,
…</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">replace</span><span class="p">(</span><span class="n">outfile</span><span class="o">=</span><span class="s1">&#39;input_template.py&#39;</span><span class="p">,</span> <span class="n">infile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="n">tokens</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;@E&#39;</span><span class="p">,</span> <span class="s1">&#39;@F&#39;</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="mf">5.2569</span><span class="p">,</span> <span class="s1">&#39;toto&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">replace</span><span class="p">(</span><span class="n">outfile</span><span class="o">=</span><span class="s1">&#39;input_template.py&#39;</span><span class="p">,</span> <span class="n">infile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="n">tokens</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;@E&#39;</span><span class="p">,</span> <span class="s1">&#39;@F&#39;</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="mf">5.2569</span><span class="p">,</span> <span class="s1">&#39;toto&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>The input_template.py file will then be modify like this :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">E</span><span class="o">=</span><span class="mf">5.25</span>
<span class="n">F</span><span class="o">=</span><span class="n">toto</span>
</pre></div>
</div>
<p>Be careful with overlapping tokens:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># if input_template.py = &#39;E=@E EE=@EE&#39;)</span>
<span class="n">replace</span><span class="p">(</span><span class="n">infile</span><span class="o">=</span><span class="s2">&quot;input_template.py&quot;</span><span class="p">,</span>
<span class="n">outfile</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
<span class="n">tokens</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;@E&quot;</span><span class="p">,</span> <span class="s2">&quot;@EE&quot;</span><span class="p">],</span>
<span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="c1"># =&gt; raise exception!! -&gt; @EE token not found!</span>
<span class="c1"># (this is due to the first pass with token &quot;@E&quot; that modify</span>
<span class="c1"># &quot;input_template.py&quot; like this : &#39;E=1 EE=1E&#39;)</span>
</pre></div>
</div>
<p>Solution to overlapping tokens: put longest tokens first:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># template.in = &#39;E=@E EE=@EE&#39;)</span>
<span class="n">replace</span><span class="p">(</span><span class="n">infile</span><span class="o">=</span><span class="s2">&quot;template.in&quot;</span><span class="p">,</span>
<span class="n">outfile</span><span class="o">=</span><span class="s2">&quot;prgm_data.in&quot;</span><span class="p">,</span>
<span class="n">tokens</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;@EE&quot;</span><span class="p">,</span> <span class="s2">&quot;@E&quot;</span><span class="p">],</span>
<span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="c1"># =&gt; prgm_data.in = &#39;E=1 EE=2&#39;)</span>
</pre></div>
</div>
</div>
<div class="section" id="the-execute-function">
<h5>The execute function<a class="headerlink" href="#the-execute-function" title="Permalink to this headline">¶</a></h5>
<p>can launch an external code.</p>
<hr class="docutils" />
<p><em>execute(cmd, workdir=None, is_shell=False, shell_exe=None,
hide_win=True, check_exit_code=True, get_stdout=False,
get_stderr=False)</em></p>
<hr class="docutils" />
<p><em>cmd</em>: a string representing the command. e.g.: ’ls -l /home’</p>
<p><em>workdir</em>: set the current directory of the executed command</p>
<p><em>is_shell</em>: if set to True, the command is started in a shell (bash).
default: False.</p>
<p><em>shell_exe</em>: path to the shell. e.g. /bin/zsh. default: None:
/bin/bash.</p>
<p><em>hide_win</em>: hide cmd.exe popup on windows</p>
<p><em>check_exit_code</em>: if set to True: raise a RuntimeError exception if
return code of process != 0</p>
<p><em>get_stdout</em>: whether standard output of the command is returned</p>
<p><em>get_stderr</em>: whether standard error of the command is returned</p>
<hr class="docutils" />
<p>the exit code of the command</p>
<p>the stdout data if get_stdout parameter is set</p>
<p>the stderr data if get_stderr parameter is set</p>
</div>
<div class="section" id="the-get-value-function">
<h5>The get_value function<a class="headerlink" href="#the-get-value-function" title="Permalink to this headline">¶</a></h5>
<p>can deal with several type of output file.</p>
<hr class="docutils" />
<p><em>get_value(filename, token=None, skip_token=0, skip_line=0,
skip_col=0, encoding=default_encoding)</em></p>
<hr class="docutils" />
<p><em>filename</em>: a file that will be parsed</p>
<p><em>token</em>: a regex that will be searched. The value right after the token
is returned. Default: None (no token searched)</p>
<p><em>skip_token</em>: the number of tokens that will be skipped before getting
the value. If set to != 0, the corresponding token parameter must not be
equal to None. If skip_tokens &lt; 0: count tokens backward from the end
of the file. Default: 0: no token skipped</p>
<p><em>skip_line</em>: number of lines skipped from the token found. If
corresponding token equal None, skip from the beginning of the file. If
corresponding token != None, skip from the token. If skip_line &lt; 0:
count lines backward from the token or from the end of the file. Be
careful: a last empty line is taken into account too. Default: 0: no
line skipped</p>
<p><em>skip_col</em>: number of columns skipped from the token found. If
corresponding token = None, skip words from the beginning of the line.
If corresponding token != None, skip words from the token. If skip_col
&lt; 0: count col backward from the end of the line or from the token.
Default: 0: no column skipped</p>
<p><em>encoding</em>: the file encoding, as string, i.e. ascii, latin_1, utf_8,
…</p>
<hr class="docutils" />
<p>a real value</p>
<ul>
<li><p class="first">content of the results.out file used for the following examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">1</span>  <span class="mi">2</span>  <span class="mi">3</span>  <span class="mi">04</span>  <span class="mi">5</span>  <span class="mi">6</span>
<span class="mi">7</span>  <span class="mi">8</span>  <span class="mi">9</span>  <span class="mi">10</span>
<span class="mi">11</span> <span class="mi">12</span> <span class="mi">13</span> <span class="mi">14</span>

<span class="nd">@Y1</span><span class="o">=</span> <span class="mf">11.11</span><span class="n">celcius</span>
<span class="nd">@Y2</span><span class="o">=</span> <span class="o">-</span><span class="mf">0.89</span>
<span class="nd">@Y1</span><span class="o">=</span> <span class="mf">22.22</span>
<span class="nd">@Y1</span><span class="o">=</span> <span class="mf">33.33</span>

<span class="n">line1</span><span class="p">:</span> <span class="mi">100</span> <span class="mi">101</span> <span class="mi">102</span>
<span class="n">line2</span><span class="p">:</span> <span class="mi">200</span> <span class="mi">201</span> <span class="mi">202</span>
<span class="n">line3</span><span class="p">:</span> <span class="mi">300</span> <span class="mi">301</span> <span class="mi">302</span>
</pre></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">search token, the value right after the token is returned:</div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Y</span> <span class="o">=</span> <span class="n">get_value</span><span class="p">(</span><span class="s1">&#39;results.out&#39;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s1">&#39;@Y1=&#39;</span><span class="p">)</span> <span class="c1"># 11.11</span>
</pre></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">skip lines and columns (useful for array search):</div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">get_value</span><span class="p">(</span><span class="s1">&#39;results.out&#39;</span><span class="p">,</span> <span class="n">skip_line</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">skip_col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># 9</span>
</pre></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">skip lines and columns backward (be careful: if there is an empty
line at the end of the file, it is taken into account. i.e. this
last empty line will be reached using skip_line=-1):</div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">get_value</span><span class="p">(</span><span class="s1">&#39;results.out&#39;</span><span class="p">,</span> <span class="n">skip_line</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">skip_col</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># 201</span>
</pre></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">search the 3rd appearance of the token:</div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">get_value</span><span class="p">(</span><span class="s1">&#39;results.out&#39;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s1">&#39;@Y1=&#39;</span><span class="p">,</span> <span class="n">skip_token</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># 33.33</span>
</pre></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">search the 2nd appearance of the token from the end of the file:</div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">get_value</span><span class="p">(</span><span class="s1">&#39;results.out&#39;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s1">&#39;@Y1=&#39;</span><span class="p">,</span> <span class="n">skip_token</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># 22.22</span>
</pre></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">search a token and then skip lines and columns from this token:</div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">get_value</span><span class="p">(</span><span class="s1">&#39;results.out&#39;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s1">&#39;@Y1=&#39;</span><span class="p">,</span> <span class="n">skip_line</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">skip_col</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># 101</span>
</pre></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">search the 2nd token and then skip lines and columns from this
token:</div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">get_value</span><span class="p">(</span><span class="s1">&#39;results.out&#39;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s1">&#39;@Y1=&#39;</span><span class="p">,</span> <span class="n">skip_token</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">skip_line</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">skip_col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># 300</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="the-get-function">
<h5>The get function<a class="headerlink" href="#the-get-function" title="Permalink to this headline">¶</a></h5>
<div class="line-block">
<div class="line">works actually the same way the get_value function do, but on several
parameters:</div>
</div>
<hr class="docutils" />
<p><em>get(filename, tokens=None, skip_tokens=None, skip_lines=None,
skip_cols=None, encoding=default_encoding)</em></p>
<hr class="docutils" />
<p><em>filename</em>: a file that will be parsed</p>
<p><em>tokens</em>: see [getvalue] function</p>
<p><em>skip_tokens</em>: see [getvalue] function</p>
<p><em>skip_lines</em>: see [getvalue] function</p>
<p><em>skip_cols</em>: see [getvalue] function</p>
<p><em>encoding</em>: the file encoding, as string, i.e. ascii, latin_1, utf_8,
…</p>
<hr class="docutils" />
<p>a list of real values.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;results.out&#39;</span><span class="p">,</span> <span class="n">tokens</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;@Y1=&#39;</span><span class="p">,</span> <span class="s1">&#39;@Y2&#39;</span><span class="p">],</span> <span class="n">skip_lines</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">skip_cols</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="c1"># [101, -0.89]</span>
</pre></div>
</div>
</div>
<div class="section" id="the-get-regex-function">
<h5>The get_regex function<a class="headerlink" href="#the-get-regex-function" title="Permalink to this headline">¶</a></h5>
<div class="line-block">
<div class="line">parses the outfile. It is provided for backward compatibility:</div>
</div>
<hr class="docutils" />
<p><em>get_regex(filename, patterns)</em></p>
<hr class="docutils" />
<p><em>filename</em>: the file to parse</p>
<p><em>patterns</em>: a list of patterns that will permit to get the values. \R
and \I can be used to match float and integer. \s can be used to
match any whitespace character (= [ \t\n\r\f\v]) \S
can be used to match any non-whitespace character. The value to be
searched must be surrounded by ’(’ and ’)’ (see example).</p>
<hr class="docutils" />
<p>a list of values corresponding to each pattern. If nothing has been
found, the corresponding value is set to None.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Y</span> <span class="o">=</span> <span class="n">get_regex</span><span class="p">(</span><span class="s1">&#39;results.out&#39;</span><span class="p">,</span> <span class="n">patterns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;@Y2=(\R)&#39;</span><span class="p">])</span> <span class="c1"># -0.89</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="reference">
<h4>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">¶</a></h4>
<p>Most up to date coupling tools module documentation is available through
docstring in Python console:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">openturns</span> <span class="k">as</span> <span class="nn">ot</span>
<span class="n">help</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">coupling_tools</span><span class="o">.</span><span class="n">get_value</span><span class="p">)</span>
</pre></div>
</div>
<p>Or in IPython console:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ot.coupling_tools.replace?
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="performance-considerations-speedo">
<h2>Performance considerations[speedo]<a class="headerlink" href="#performance-considerations-speedo" title="Permalink to this headline">¶</a></h2>
<p>Two differents cases can be encounter when wrapping code: the wrapping
code is an analytical mathematical formula or it is an external code (an
external process).</p>
<div class="section" id="analytical-formula">
<h3>Analytical formula<a class="headerlink" href="#analytical-formula" title="Permalink to this headline">¶</a></h3>
<p>A benchmark involving the differents wrapping methods available from
&nbsp;has been done using a dummy Analytical formula.</p>
<div class="section" id="benchmark-sources">
<h4>Benchmark sources<a class="headerlink" href="#benchmark-sources" title="Permalink to this headline">¶</a></h4>
<p>Optimizations of any parts of this benchmark are welcome.</p>
<ul>
<li><p class="first">Benchmark of PythonFunction using _exec function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">big_sample</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">getSample</span><span class="p">(</span><span class="mi">1000</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">openturns</span> <span class="k">as</span> <span class="nn">ot</span>

<span class="k">def</span> <span class="nf">_exec</span><span class="p">(</span> <span class="n">X</span> <span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">PythonFunction</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">_exec</span><span class="p">)</span>
    <span class="c1"># start timer</span>
    <span class="n">out_sample</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span> <span class="n">big_sample</span> <span class="p">)</span>
    <span class="c1"># stop timer</span>
</pre></div>
</div>
</li>
<li><p class="first">Benchmark of PythonFunction using _exec_sample function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_exec_sample</span><span class="p">(</span> <span class="n">Xs</span> <span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="n">XsT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Xs</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">xT</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">xT</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">PythonFunction</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">func_sample</span><span class="o">=</span><span class="n">_exec_sample</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Benchmark of Analytical (muParser) function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span> <span class="p">(</span><span class="s1">&#39;x0&#39;</span><span class="p">,</span><span class="s1">&#39;x1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,),</span>
<span class="p">(</span><span class="s1">&#39;cos((x0+1) ^ 2) - sin(x1)&#39;</span><span class="p">,)</span> <span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>The benchmark is done on a bi XEON E5520 (Nehalem 16*2.27GHz, HT
activated) with 12Go RAM.</p>
</div>
<div class="section" id="benchmark-results">
<h4>Benchmark results<a class="headerlink" href="#benchmark-results" title="Permalink to this headline">¶</a></h4>
<p>:</p>
<p>The sample containing 1 million of points is allocated in 0.282s.</p>
<table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="12%" />
<col width="45%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>wrapper type</td>
<td>time</td>
<td>comparison with fastest wrapper</td>
</tr>
<tr class="row-even"><td>PythonFunction _exec</td>
<td>7.1s</td>
<td>x157</td>
</tr>
<tr class="row-odd"><td>PythonFunction _exec_sample</td>
<td>1.3s</td>
<td>x30</td>
</tr>
<tr class="row-even"><td>Analytical (muParser)</td>
<td>0.43s</td>
<td>x10</td>
</tr>
</tbody>
</table>
<p>The previous results are linear to the size of the sample.</p>
<ul>
<li><p class="first">muParser is the 2nd fastest (10 times slower than the first).</p>
<p>The muParser library used is not multithreaded. Embedding a
parallel version of muParser could give better results.</p>
</li>
<li><p class="first">Using an optimized _exec_sample python function through numpy gives
better results (6x faster) than a simple _exec python function, but
it is still much slower than the compiled library (30 times slower).</p>
<p>Note that neither Python nor NumPy are multithreaded.</p>
</li>
</ul>
</div>
<div class="section" id="conclusion">
<h4>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h4>
<p>PythonFunction is the easiest and more adaptable wrapper but it’s the
slowest too. So, if you need to compute samples containing less than a
million of points, PythonFunction is the good choice as the speed
difference between wrappers will not be noticeable: every wrappers will
compute the sample in less than a second. Otherwise choose muParser.</p>
</div>
</div>
<div class="section" id="external-process">
<h3>External process<a class="headerlink" href="#external-process" title="Permalink to this headline">¶</a></h3>
<div class="section" id="normal-program">
<h4>Normal program<a class="headerlink" href="#normal-program" title="Permalink to this headline">¶</a></h4>
<p>For usual program (compute time of 1s and above), inner wrapper
complexity/overhead are not an issue cause the external program compute
time will be the main part of the whole compute time. Sample can be
computed faster by launching this external program in parallel.</p>
<ul class="simple">
<li>PythonFunction can not launch the _exec function in parallel.</li>
<li>the DistributedPythonFunction from otdistfunc module can launch
external program on each core of the local Machine or on each core of
several remote machine.</li>
</ul>
<p>The DistributedPythonFunction is the best choice as it combine the ease
of use of Python with the ability to deploy compute on a cluster of
computers.</p>
</div>
<div class="section" id="tiny-program">
<h4>Tiny program<a class="headerlink" href="#tiny-program" title="Permalink to this headline">¶</a></h4>
<p>If the external process compute time is really fast (&lt; 0.1s), &nbsp;wrapper
point’s launch time (overhead) becomes important.</p>
<p>If performance are an issue, one should first consider that the external
process is perhaps fast because it does something simple: can it be
easily reimplemented in Python? If the code is not too complex, execute
Python code inside a PythonFunction is usually much faster than the time
to start the external process (&nbsp;1000x). Here is a naive example of
external process (scilab) vs PythonFunction.</p>
<ul>
<li><p class="first">The following scilab script takes 0.07s per point:</p>
<p><code class="docutils literal"><span class="pre">$</span> <span class="pre">scilab</span> <span class="pre">-nb</span> <span class="pre">-nwni</span> <span class="pre">-f</span> <span class="pre">code.sce</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">code</span><span class="o">.</span><span class="n">sce</span>
<span class="n">exec</span><span class="p">(</span><span class="s2">&quot;input.data&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span><span class="p">;</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">mopen</span><span class="p">(</span><span class="s2">&quot;result.data&quot;</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">);</span>
<span class="n">mfprintf</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;y = </span><span class="si">%.20e</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
<span class="n">file</span><span class="p">(</span><span class="s2">&quot;close&quot;</span><span class="p">,</span> <span class="n">f</span><span class="p">);</span>
<span class="n">quit</span>
</pre></div>
</div>
</li>
<li><p class="first">Conversion to Python of the scilab script. It takes now 0.00001s per
point:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_exec</span><span class="p">(</span> <span class="n">X</span> <span class="p">):</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">PythonFunction</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">_exec</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>If you still need to launch tiny external process, slow overhead and
parallel ability are the important factors of the wrapper. Comparison of
the differents wrapper compute time with a sample of size 1000 and an
external code that last 0.07s per point on a 8 cores computer:</p>
<ul>
<li><p class="first">PythonFunction overhead is really slow (0.000004s) but can not launch
the _exec function in parallel.</p>
<p><img class="math" src="../_images/math/34a8e67daf9e511a452ceb253a1b3a9b1926f9d8.svg" alt="(0.000004+0.07)*1000 =&gt; 70s"/></p>
</li>
<li><p class="first">DistributedPythonFunction overhead is near 0.05s and can launch
external program in parallel.</p>
<p><img class="math" src="../_images/math/d0da9fe1752e190cd50e9f0a626c8276b8e8eafb.svg" alt="(0.05+0.07)*1000 (/8core) =&gt; 15s"/></p>
</li>
<li><p class="first">PythonFunction that reimplement the external program.</p>
<p><img class="math" src="../_images/math/0573b589d288b28ab12105b698c7c622f1b04572.svg" alt="(0.00001)*1000 =&gt; 0.01s"/></p>
</li>
</ul>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="git_workflow.html" title="Git workflow"
             >next</a> |</li>
        <li class="right" >
          <a href="module_development.html" title="Module development"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">OpenTURNS  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="developer_guide.html" >Contribute</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005-2017 Airbus-EDF-IMACS-Phimeca.
      Last updated on Oct 10, 2017.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.4.
    </div>
  </body>
</html>